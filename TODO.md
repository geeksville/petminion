# TODO

- DONE make proposed state machine for initial crow and cat trainer - figure out how to deal with multiple deliveries for multiple rewards
- DONE make basic API for recognizer/camera
- DONE make state machineish training rules engine (find existing state machine lib?)
- DONE use recognizer keywords in the training rules
- DONE make count_detections work
- DONE make ZigbeeFeeder class 
- Make app install instructions
- DONE make a simple scheduled based cat feeder that only enables feedings at mealtime and only dispenses food when a) a feeding is allowed and b) a cat is seen
- DONE have a max feedings per day / per hour / per x feature for rules. or possibly have the feeder enforce that and throw an exception up?
- DONE add github actions to do test builds and run tests per https://github.com/geeksville/petminion/actions/new
- DONE switch to the !docker version of mosquitto - to be more like the rasberry pi environment
- DONE make zigbee2mqtt config script/instructions - use docker - even when running on rasberry pi
- DONE make a deploy to corral board script
- DONE measure feeding amount in grams.   
- DONE store live camera frames to /tmp
- make camera optional for scheduled feedings
- DONE switch Meer feeding over to use the non-camera based feeder
- DONE log messages to file
- DONE Use reddit API to post meer feeding pics
- DONE disable simulator fallback on real device
- use regexes for alias handling
- DONE switch Meer feeding over to use the camera based feeder
- DONE make opencv based ball detector (eventually support region detection based on colored gaffers tape)
- DONE make unit tests for image detector and ball detector
- DONE make integration test work better https://github.com/spulec/freezegun 
- DONE use color match card https://pyimagesearch.com/2021/02/15/automatic-color-correction-with-opencv-and-python/
- DONE confirm we are not running the classifer - only the detector
- DONE grab frames at a higher resolution but then downsample them for machine-vision purposes.  Use the higher res pictures for video/social media purposes
- DONE Make social media post include info on # feedings, cat seen, and # balls
- DONE make video as cat walks towards feeder.  start video once we've decided a feeding is deserved... [https://stackoverflow.com/questions/48817441/opencv-encoding-to-h264 ](https://github.com/PyAV-Org/PyAV/issues/471)
- DONE finish cat training rule 0
- move rules to their own submodule
- fix html doc gen
- find a better app messaging solution than mastodon - https://support.pushover.net/i44-example-code-and-pushover-libraries#python-image + https://www.freecodecamp.org/news/how-to-convert-video-files-to-gif-in-python/
- do new pypi release
- use flask for a small web server https://pyimagesearch.com/2019/09/02/opencv-stream-video-to-web-browser-html-page/
- DONE make simcamera actually useful
- DONE have live camera dump success and occasional failure images to directories (for training & sim camera use)
- add blackout periods to rules, to prevent any feeding or image processing during those periods 
- remove bogus scheduled feeding that seems to be by default in the zigbee feeder
- add current BOM to the README
- let config based templates build the titles for social media posts
- add basic developer instructions / clean up development docs (include how to install and setup python env)
- fix pypi release scripts to use pillow
- log high level events (feedings etc...) into a file so that users can remotely monitor
- merge detector and classifier responses?
- use minium score for considered matches
- map detections through an aliases table.  Use uppercase words for aliases (CAT, CROW etc).  Use a BLACKLIST alias for detections we never want to see (have an aliases dictionary that maps from grackle, bluejay, crow etc...)
- generate an alert push if no feedings happened in a day
- keep unexpected recognizer words in a log file 
- add method documentation for all the key methods
- Use a should_trigger() method in the rules to allow multiple rules to be candidates at once
- possibly use camera to make a squirrel proof feeder
- Get remote debugging working
- figure out gpioish mechanism (3d print? off the shelf?) for a door that drops tokens or uneaten food into a bucket
- Have recognizer save interesting frames to a directory.  Where interesting
    can be: something not blank, something that is a bird.
- have a blacklist of mistaken matches which we will never consider interesting  
- DONE Store image and the matching terms in a separate datafile  
- Only store a max of one frame every 30 seconds.
- convert models to tensorflow lite which supposedly runs much faster on rPi https://www.tensorflow.org/lite/guide/python
- DONE - DietPi - Find a rasberry pi distribution which can be auto populated to generate 'easy' install images for this app and all its dependencies
- automatically load training rules from a directory.  This will allow users to make/share rules without using git/github
- Add hotreloading of rules based on file changes
- DONE have the python app auto fetch teh (huge) machine vision model files
- link petminion.org to the github pages site
- during development post 'success' images to mastodon https://mastodonpy.readthedocs.io/en/stable/

